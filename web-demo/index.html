<!DOCTYPE html>
<html>
<head>
    <title>PixelFlow Psychedelic Shader</title>
    <style>
        body { margin: 0; background: #000; display: flex; justify-content: center; align-items: center; height: 100vh; }
        canvas { max-width: 100%; max-height: 100%; }
    </style>
</head>
<body>
    <canvas id="canvas" width="800" height="600"></canvas>
    <script type="module">
        import init, { Renderer } from './pkg/web_demo.js';

        async function main() {
            const wasm = await init();

            const canvas = document.getElementById('canvas');
            const ctx = canvas.getContext('2d');
            const renderer = new Renderer(canvas.width, canvas.height);

            function frame(time) {
                renderer.render(time / 1000);

                // Get buffer from WASM memory
                const ptr = renderer.buffer_ptr();
                const len = renderer.buffer_len();
                const memory = new Uint8ClampedArray(
                    wasm.memory.buffer, ptr, len
                );

                const imageData = new ImageData(memory, canvas.width, canvas.height);
                ctx.putImageData(imageData, 0, 0);

                requestAnimationFrame(frame);
            }

            requestAnimationFrame(frame);
        }

        main();
    </script>
</body>
</html>
