[package]
name = "core-term"
version = "0.1.0"
edition = "2021"

[dependencies]
anyhow = "1.0.98"
bitflags = { version = "2.9.0", features = ["serde"] }
env_logger = "0.11.8"
once_cell = "1.19.0" # Added for Lazy static initialization
libc = "0.2.172"
log = "0.4.27"
nix = { version = "0.30.0", features = ["term", "process", "fs", "ioctl", "signal"] }
serde = { version = "1.0.219", features = ["derive"] }
serde_json = "1.0.140"
termios = "0.3.3"
pprof = { version = "0.14", features = ["flamegraph", "criterion"], optional = true }

# Display driver dependencies - feature-gated for flexibility
[dependencies.objc2]
version = "0.6"
optional = true

[dependencies.objc2-foundation]
version = "0.3"
features = ["NSString", "NSDate", "NSAutoreleasePool", "NSGeometry", "NSRunLoop"]
optional = true

[dependencies.objc2-app-kit]
version = "0.3"
features = ["NSApplication", "NSWindow", "NSView", "NSEvent", "NSColor", "NSPasteboard"]
optional = true

[dependencies.core-foundation]
version = "0.9"
optional = true

[dependencies.core-graphics]
version = "0.24"
optional = true

[dependencies.core-text]
version = "20.1"
optional = true

[dependencies.x11]
version = "2.21.0"
optional = true

[dependencies.yeslogic-fontconfig-sys]
version = "6.0.0"
optional = true

[dependencies.freetype]
version = "0.7"
optional = true

# Legacy cocoa/objc for old platform/backends code (target_os gated for now)
[target.'cfg(target_os = "macos")'.dependencies]
cocoa = "0.26"
objc = "0.2"

[build-dependencies]
pkg-config = "0.3.32"

[dev-dependencies]
test-log = "0.2.17"
rexpect = "0.6.1"

[features]
# Display driver features
display_cocoa = [
    "objc2",
    "objc2-foundation",
    "objc2-app-kit",
    "core-foundation",
    "core-graphics",
    "core-text",
]
display_x11 = [
    "x11",
    "yeslogic-fontconfig-sys",
    "freetype",
    "core-foundation",  # For CocoaFontDriver on macOS
    "core-graphics",    # For CocoaFontDriver on macOS
    "core-text",        # For CocoaFontDriver on macOS
]
display_headless = []

# Default feature strategy:
# We enable display_cocoa by default as it's the most common development platform.
# Users on Linux should explicitly use: cargo build --features display_x11
# Users wanting headless should use: cargo build --features display_headless --no-default-features
#
# The build.rs will select the appropriate driver based on:
# 1. DISPLAY_DRIVER env var (highest priority)
# 2. Enabled features (what's specified here or on command line)
# 3. Target OS fallback (if none of the above apply)
default = ["display_cocoa"]
profiling = ["pprof"]

